/*!
 Leaflet.TileLayer.Fallback 1.0.3+cb72f5a
 (c) 2015-2016 Boris Seang
 License Apache-2.0
 */
!function(i,r){"function"==typeof define&&define.amd?define(["leaflet"],r):r("object"==typeof module&&module.exports?require("leaflet"):i.L)}(this,function(i){var r=i.TileLayer.extend({options:{minNativeZoom:0},initialize:function(r,e){i.TileLayer.prototype.initialize.call(this,r,e)},createTile:function(r,e){var t=i.TileLayer.prototype.createTile.call(this,r,e);return t._originalCoords=r,t._originalSrc=t.src,t},_createCurrentCoords:function(i){var r=this._wrapCoords(i);return r.fallback=!0,r},_originalTileOnError:i.TileLayer.prototype._tileOnError,_tileOnError:function(i,r,e){var t,o,l,a=this,n=r._originalCoords,c=r._currentCoords=r._currentCoords||a._createCurrentCoords(n),s=r._fallbackZoom=(r._fallbackZoom||n.z)-1,f=r._fallbackScale=2*(r._fallbackScale||1),p=a.getTileSize(),u=r.style;return s<a.options.minNativeZoom?this._originalTileOnError(i,r,e):(c.z=s,c.x=Math.floor(c.x/2),c.y=Math.floor(c.y/2),t=a.getTileUrl(c),u.width=p.x*f+"px",u.height=p.y*f+"px",o=(n.y-c.y*f)*p.y,u.marginTop=-o+"px",l=(n.x-c.x*f)*p.x,u.marginLeft=-l+"px",u.clip="rect("+o+"px "+(l+p.x)+"px "+(o+p.y)+"px "+l+"px)",a.fire("tilefallback",{tile:r,url:r._originalSrc,urlMissing:r.src,urlFallback:t}),void(r.src=t))},getTileUrl:function(r){var e=r.z=r.fallback?r.z:this._getZoomForUrl(),t={r:i.Browser.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:e};if(this._map&&!this._map.options.crs.infinite){var o=this._globalTileRange.max.y-r.y;this.options.tms&&(t.y=o),t["-y"]=o}return i.Util.template(this._url,i.extend(t,this.options))}});i.tileLayer.fallback=function(i,e){return new r(i,e)}});